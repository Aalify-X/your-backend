<!DOCTYPE html>
<html>
<head>
    <title>Progrify Access</title>
    <script src="https://cdn.whop.com/js/embed.js"></script>
    <style>
        #whop-container {
            width: 100%;
            max-width: 400px;
            margin: 50px auto;
            min-height: 500px;
        }
        .loading {
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div id="whop-container">
        <div class="loading">Loading verification...</div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        window.whopWidget.initialize({
            sellerId: "app_dyAJyqA7FjKF24",  // MUST REPLACE
            productId: "prod_2bPcTPEWlcclz", // MUST REPLACE
            containerId: "whop-container",
            onSuccess: async function(data) {
                try {
                    const response = await fetch('/api/verify_whop', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${data.token}`,
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include'
                    });
                    
                    if (response.ok) {
                        window.location.href = "/";  // Redirect to main app
                    } else {
                        alert("Verification failed");
                    }
                } catch (error) {
                    alert("Connection error");
                }
            },
            onFailure: function(error) {
                alert("Payment verification failed: " + error.message);
            }
        });
    });
    </script>
</body>
</html>
